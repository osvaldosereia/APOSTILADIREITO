<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Apostila Direito ‚Äî AD</title>
  <meta name="description" content="Gerador de prompts jur√≠dicos refinados (com estrat√©gias de Apostila, Simulado, FAQ, Casos e Resumo)." />
  <meta name="theme-color" content="#072C36" />
  <link rel="manifest" href="manifest.webmanifest">
  <style>
    body{margin:0;font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:#fff;color:#111}
    .wrap{max-width:900px;margin:0 auto;padding:28px 18px 60px}
    header{display:flex;align-items:center;gap:12px;margin-bottom:20px}
    .logo{width:42px;height:42px;border-radius:10px;background:#072C36;display:grid;place-items:center}
    .logo span{font-weight:800;color:#fff}
    h1{margin:0;font-size:22px;color:#072C36}
    .sub{color:#555;font-size:13px}
    .card{border:1px solid #ddd;border-radius:14px;padding:16px;margin-bottom:16px;box-shadow:0 2px 5px rgba(0,0,0,.05)}
    label{display:block;font-size:14px;margin:8px 0 6px;color:#072C36}
    input,select,textarea{width:100%;padding:12px;border:1px solid #ccc;border-radius:12px;font-size:16px}
    textarea{resize:vertical;min-height:320px}
    .row{display:grid;grid-template-columns:1fr;gap:12px}
    @media(min-width:640px){.row{grid-template-columns:1fr 1fr}}
    @media(min-width:960px){.row{grid-template-columns:1.2fr 1fr 1fr 1fr 1fr 1fr 1fr}}
    select{min-height:44px}
    .btn{border:none;border-radius:12px;padding:10px 16px;font-weight:700;cursor:pointer;width:100%}
    .btn.primary{background:#25C0BA;color:#fff}
    .actions{display:flex;gap:10px;margin-top:10px;flex-wrap:wrap}
    .actions .btn{width:auto}
    @media(max-width:639px){.actions{flex-direction:column}.actions .btn{width:100%}}
    footer{margin-top:20px;font-size:12px;color:#777;text-align:center}
  </style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="logo"><span>AD</span></div>
    <div>
      <h1>Apostila Direito</h1>
      <div class="sub">Gerador de prompts ‚Äî Estrat√©gias: Apostila / Simulado / FAQ / Casos / Resumo</div>
    </div>
  </header>

  <form class="card" id="form" onsubmit="return false">
    <h2>Configura√ß√µes</h2>
    <div class="row">
      <div>
        <label for="estrategia">Estrat√©gia</label>
        <select id="estrategia">
          <option value="Apostila" selected>Apostila</option>
          <option value="Simulado">Simulado</option>
          <option value="FAQ">FAQ</option>
          <option value="Casos">Casos</option>
          <option value="Resumo">Resumo</option>
        </select>
      </div>
      <div>
        <label for="titulo">Tema</label>
        <input id="titulo" placeholder="Ex.: Importuna√ß√£o Sexual ‚Äî Art. 215-A (CP)" />
      </div>
      <div>
        <label for="materia">Mat√©ria</label>
        <select id="materia">
          <option value="" disabled selected>Selecione</option>
          <optgroup label="Direito P√∫blico">
            <option>Direito Constitucional</option>
            <option>Direito Administrativo</option>
            <option>Direito Tribut√°rio</option>
            <option>Direito Financeiro</option>
            <option>Direito Eleitoral</option>
            <option>Direito Ambiental</option>
            <option>Direito Internacional</option>
            <option>Direito Militar</option>
          </optgroup>
          <optgroup label="Direito Privado">
            <option>Direito Civil</option>
            <option>Direito Empresarial</option>
            <option>Direito do Consumidor</option>
            <option>Direito Previdenci√°rio</option>
          </optgroup>
          <optgroup label="Direito do Trabalho">
            <option>Direito do Trabalho</option>
            <option>Processo do Trabalho</option>
          </optgroup>
          <optgroup label="Direito Penal">
            <option>Direito Penal</option>
            <option>Processo Penal</option>
            <option>Execu√ß√£o Penal</option>
            <option>Criminologia</option>
          </optgroup>
          <optgroup label="Processual Civil">
            <option>Processo Civil</option>
          </optgroup>
          <optgroup label="Forma√ß√£o e √âtica">
            <option>Introdu√ß√£o ao Estudo do Direito</option>
            <option>Teoria Geral do Direito</option>
            <option>Filosofia do Direito</option>
            <option>Sociologia do Direito</option>
            <option>Hermen√™utica Jur√≠dica</option>
            <option>√âtica Profissional e Estatuto da OAB</option>
            <option>Metodologia da Pesquisa Jur√≠dica</option>
          </optgroup>
        </select>
      </div>
      <div>
        <label for="nivel">N√≠vel</label>
        <select id="nivel">
          <option value="iniciante">Iniciante</option>
          <option value="intermediario" selected>Intermedi√°rio</option>
          <option value="avancado">Avan√ßado</option>
        </select>
      </div>
      <div>
        <label for="versao">Vers√£o</label>
        <select id="versao">
          <option value="express">Express</option>
          <option value="completa" selected>Completa</option>
          <option value="avancada">Avan√ßada</option>
        </select>
      </div>
      <div>
        <label for="linguagem">Linguagem</label>
        <select id="linguagem">
          <option value="clara" selected>Clara</option>
          <option value="tecnica">T√©cnica</option>
          <option value="professor">Professor</option>
        </select>
      </div>
      <div>
        <label for="juris">Jurisprud√™ncia</label>
        <select id="juris">
          <option value="off" selected>Sem jurisprud√™ncia</option>
          <option value="resumo">S√≠ntese descritiva (sem n¬∫)</option>
          <option value="completa">Completa (com refer√™ncia)</option>
        </select>
      </div>
      <div style="display:flex;align-items:end">
        <button id="gerar" class="btn primary" type="button">Gerar prompt</button>
      </div>
    </div>
  </form>

  <div class="card">
    <h2>Prompt</h2>
    <textarea id="saida" placeholder="O prompt aparece aqui..."></textarea>
    <div class="actions">
      <button class="btn primary" id="copiar" type="button">Copiar</button>
    </div>
  </div>

  <footer>Apostila Direito ‚Ä¢ AD</footer>
</div>

<script>
// === Diretrizes por Mat√©ria (aplique s√≥ quando pertinentes ao tema) ===
const bySubject = {
  'Direito Constitucional': `Orienta√ß√£o: aplique apenas institutos pertinentes ao t√≠tulo (direitos fundamentais, organiza√ß√£o do Estado, controle).`,
  'Direito Administrativo': `Orienta√ß√£o: foque em atos, poderes, licita√ß√µes/contratos e controle **se** ligados ao tema.`,
  'Direito Tribut√°rio': `Orienta√ß√£o: princ√≠pios e cr√©dito/lan√ßamento **quando pertinentes** ao tema.`,
  'Direito Financeiro': `Orienta√ß√£o: or√ßamento p√∫blico (PPA/LDO/LOA) e responsabilidade fiscal **se** houver nexo.`,
  'Direito Eleitoral': `Orienta√ß√£o: direitos pol√≠ticos, propaganda e a√ß√µes eleitorais **conforme** o t√≠tulo.`,
  'Direito Ambiental': `Orienta√ß√£o: princ√≠pios, licenciamento, responsabilidade ambiental **se** fizer sentido ao tema.`,
  'Direito Internacional': `Orienta√ß√£o: tratados/fontes, coopera√ß√£o, conflito de leis **apenas quando aplic√°vel**.`,
  'Direito Militar': `Orienta√ß√£o: CPM/CPPM e compet√™ncia da Justi√ßa Militar **apenas se pertinente**.`,
  'Direito Civil': `Orienta√ß√£o: ajuste aos subdom√≠nios relevantes (posse, usucapi√£o, contratos, fam√≠lia, sucess√µes, responsabilidade) ‚Äî **n√£o inclua** os que n√£o tiverem nexo com o t√≠tulo.`,
  'Direito Empresarial': `Orienta√ß√£o: sociedades, t√≠tulos de cr√©dito, recupera√ß√£o/fal√™ncia **conforme** o tema.`,
  'Direito do Consumidor': `Orienta√ß√£o: v√≠cio/fato, pr√°ticas abusivas e garantias **se** o t√≠tulo demandar.`,
  'Direito Previdenci√°rio': `Orienta√ß√£o: benef√≠cios/processo previdenci√°rio **apenas se ligado** ao t√≠tulo.`,
  'Direito do Trabalho': `Orienta√ß√£o: v√≠nculo, jornada, rescis√£o; teletrabalho/terceiriza√ß√£o **se** cab√≠vel.`,
  'Processo do Trabalho': `Orienta√ß√£o: rito, prova e recursos **somente** quando necess√°rios ao tema.`,
  'Direito Penal': `Orienta√ß√£o: tipicidade, causas de exclus√£o e penas **apenas** quando ligados ao t√≠tulo.`,
  'Processo Penal': `Orienta√ß√£o: inqu√©rito, a√ß√£o penal, cautelares e recursos **quando pertinentes**.`,
  'Execu√ß√£o Penal': `Orienta√ß√£o: progress√£o/remi√ß√£o e incidentes **conforme** o tema.`,
  'Criminologia': `Orienta√ß√£o: teorias e pol√≠tica criminal **aplic√°veis** ao tema.`,
  'Processo Civil': `Orienta√ß√£o: tutelas, saneamento, prova, precedentes/recursos **ligados** ao t√≠tulo.`,
  'Introdu√ß√£o ao Estudo do Direito': `Orienta√ß√£o: fontes, ordenamento e interpreta√ß√£o **apenas** quando √∫teis ao tema.`,
  'Teoria Geral do Direito': `Orienta√ß√£o: norma/validade/efic√°cia **se** pertinente.`,
  'Filosofia do Direito': `Orienta√ß√£o: correntes filos√≥ficas **apenas se** houver nexo anal√≠tico com o tema.`,
  'Sociologia do Direito': `Orienta√ß√£o: direito e sociedade **quando** cab√≠vel.`,
  'Hermen√™utica Jur√≠dica': `Orienta√ß√£o: m√©todos interpretativos/pondera√ß√£o **se** fizer sentido.`,
  '√âtica Profissional e Estatuto da OAB': `Orienta√ß√£o: deontologia e impedimentos **conforme** o foco do t√≠tulo.`,
  'Metodologia da Pesquisa Jur√≠dica': `Orienta√ß√£o: m√©todo e ABNT **quando** o objetivo do t√≠tulo assim exigir.`
};

const today = new Date().toISOString().slice(0,10);

// === Afiliados (carregamento JSON externo) ===
let afiliados = null;
async function carregarAfiliados(){
  if (afiliados) return afiliados;
  try{
    const res = await fetch('/data/afiliados.json', { cache: 'no-store' });
    if(!res.ok) throw new Error('Falha ao carregar afiliados.json');
    afiliados = await res.json();
  }catch(e){
    console.warn('[afiliados]', e);
    afiliados = { default: [] };
  }
  return afiliados;
}
function montarBlocoDicas(arr){
  if(!arr || !arr.length) return '';
  const linhas = arr.slice(0,5).map((it,i)=>`${i+1}. [${it.label}](${it.url})`).join('\n');
  return `\n\n### üìö Dicas de Leitura *(links de afiliado Amazon)*\n${linhas}`;
}

// === Estrat√©gias (inclui RESUMO) ===
const strategies = {
  'Apostila': {
    id:'apostila', showBooks:true,
    block: ({materia, versao, nivel, linguagem}) => `
### Modo: APOSTILA
- Estruture conforme os t√≥picos did√°ticos (introdu√ß√£o, perguntas-chave, an√°lise material/processual, debates, casos pr√°ticos, resumo executivo).
- Vers√£o: **${versao}** (controla profundidade/volume). N√≠vel: **${nivel}**. Linguagem: **${linguagem}**.`
  },
  'Simulado': {
    id:'simulado', showBooks:false,
    block: ({materia, versao, nivel}) => `
### Modo: SIMULADO
- Gere **10 quest√µes objetivas (A‚ÄìD)** sobre o tema em **${materia}**.
- N√≠vel: **${nivel}**. Vers√£o: **${versao}** (ajuste a profundidade das justificativas).
- Enunciados claros e sem ambiguidade.
- **Gabarito ao final** no formato: Q1: C ‚Äî justificativa (1‚Äì3 linhas conforme vers√£o).
- Use jurisprud√™ncia apenas se selecionada e de forma sint√©tica.`
  },
  'FAQ': {
    id:'faq', showBooks:false,
    block: ({versao, nivel, linguagem}) => `
### Modo: FAQ
- Produza **10 perguntas essenciais** sobre o tema e responda cada uma.
- Adapte a extens√£o da resposta √† **Vers√£o ${versao}** (Express: 1‚Äì2 linhas; Completa: 3‚Äì5; Avan√ßada: 5‚Äì7).
- N√≠vel: **${nivel}**. Linguagem: **${linguagem}**.`
  },
  'Casos': {
    id:'casos', showBooks:true,
    block: ({versao}) => `
### Modo: CASOS
- Explique o tema por **5 casos concretos** diretamente ligados.
- Para cada caso: (1) refer√™ncia breve; (2) descri√ß√£o (2‚Äì8 linhas conforme **${versao}**); (3) conceito ilustrado e takeaway pr√°tico.
- Jurisprud√™ncia completa: refer√™ncia sint√©tica; se off: exemplos doutrin√°rios/noticiosos.`
  },
  'Resumo': {
    id:'resumo', showBooks:false,
    block: ({versao, nivel, linguagem}) => `
### Modo: RESUMO
- Elabore um **resumo estruturado** do tema com foco em defini√ß√£o, elementos essenciais, requisitos, exce√ß√µes e aplica√ß√µes pr√°ticas.
- **Extens√£o por Vers√£o**: Express (300‚Äì500 palavras); Completa (600‚Äì900); Avan√ßada (900‚Äì1200, com nuances doutrin√°rias).
- Inclua **Pontos de aten√ß√£o/Pegadinhas** (3‚Äì5 bullets) e **Exemplos r√°pidos** (2‚Äì3 bullets).
- Linguagem: **${linguagem}**. N√≠vel: **${nivel}**.
- Se jurisprud√™ncia for selecionada, traga apenas entendimentos sint√©ticos diretamente pertinentes.`
  }
};

function jurisRules(mode){
  if(mode==='off') return `- N√£o inclua jurisprud√™ncia espec√≠fica. Foque em doutrina, artigos e casos pr√°ticos.`;
  if(mode==='resumo') return `- Traga apenas tend√™ncias jurisprudenciais de forma descritiva, sem n¬∫ de processo, citando fontes secund√°rias est√°veis.`;
  if(mode==='completa') return `- Cite ac√≥rd√£os somente se houver fonte est√°vel (artigos acad√™micos, universidades, escrit√≥rios). Formato: Tribunal, Classe+N¬∫, Relator, Data, Tese (1‚Äì2 linhas). Se n√£o encontrar, escreva [N√ÉO LOCALIZADO].`;
  return '';
}
function nivelAdapt(nivel){
  if(nivel==='iniciante') return `- Adapte a linguagem (iniciante): evite juridiqu√™s, use exemplos simples.`;
  if(nivel==='intermediario') return `- Adapte a linguagem (intermedi√°rio): termos t√©cnicos com explica√ß√£o curta e exemplos pr√°ticos.`;
  if(nivel==='avancado') return `- Adapte a linguagem (avan√ßado): precis√£o t√©cnica, compara√ß√µes doutrin√°rias e vis√£o cr√≠tica.`;
  return '';
}

function buildPrompt({estrategia,titulo,materia,nivel,versao,linguagem,juris}, dicasStr=''){
  const strat = strategies[estrategia] || strategies['Apostila'];
  return `Voc√™ √© professor de **${materia}** no Brasil e deve gerar uma **${estrategia.toUpperCase()}** sobre **${titulo}** para um estudante de n√≠vel **${nivel}**. Atualize-se at√© ${today} usando pesquisa na web.

### Objetivo
Entregar material claro, bem estruturado e confi√°vel.

### Etapa de Refinamento (silenciosa, obrigat√≥ria)
1. Identifique o TEMA-N√öCLEO do t√≠tulo em 1 linha.
2. Formule 3 a 5 PERGUNTAS OBJETIVAS espec√≠ficas ao t√≠tulo.
3. Responda-as de forma breve e factual.
4. Defina um PLANO DE SE√á√ïES com base nessas respostas.
5. S√≥ ent√£o produza a entrega (${estrategia}).
- Se alguma pergunta n√£o puder ser respondida, marque [PENDENTE] e siga de forma conservadora, sem inventar.

### Estrat√©gia de conte√∫do
- Linguagem: **${linguagem}**. ${nivelAdapt(nivel)}
- Use fontes confi√°veis: cursos, universidades, artigos acad√™micos, blogs de advogados e escrit√≥rios.
${jurisRules(juris)}
- Se houver d√∫vida factual, escreva [VERIFICAR] em vez de presumir.
- **Filtro de pertin√™ncia:** n√£o inclua subtemas cl√°ssicos da mat√©ria sem nexo direto com o t√≠tulo.

### Diretriz da Mat√©ria (aplicar apenas se pertinente)
${bySubject[materia] || ''}
${strat.block({materia, versao, nivel, linguagem})}

### Sa√≠da
Entregue em **Markdown puro**. Seja claro, objetivo e tecnicamente correto.${strat.showBooks ? dicasStr : ''}`;
}

const out = document.getElementById('saida');

document.getElementById('gerar').addEventListener('click', async ()=>{
  const data = {
    estrategia: document.getElementById('estrategia').value,
    titulo: document.getElementById('titulo').value.trim(),
    materia: document.getElementById('materia').value,
    nivel: document.getElementById('nivel').value,
    versao: document.getElementById('versao').value,
    linguagem: document.getElementById('linguagem').value,
    juris: document.getElementById('juris').value
  };
  if(!data.titulo || !data.materia){ alert('Informe Tema e Mat√©ria.'); return; }

  // Afiliados: usa default (ou por mat√©ria, se adicionado depois)
  const db = await carregarAfiliados();
  const lista = (db[data.materia] && db[data.materia].length) ? db[data.materia] : (db.default || []);
  const dicasStr = montarBlocoDicas(lista);

  out.value = buildPrompt(data, dicasStr);
  out.scrollIntoView({behavior:'smooth'});
});

document.getElementById('copiar').addEventListener('click', async ()=>{
  if(!out.value){ alert('Gere o prompt primeiro.'); return; }
  try{ await navigator.clipboard.writeText(out.value); }
  catch(e){ out.select(); document.execCommand('copy'); }
  const btn = document.getElementById('copiar');
  const old = btn.textContent; btn.textContent = 'Copiado!';
  setTimeout(()=> btn.textContent = old, 1200);
});
</script>
</body>
</html>
