<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Apostila Direito — AD</title>
  <meta name="description" content="Gerador de prompts jurídicos refinados (com estratégias de Apostila, Simulado, FAQ, Casos e Resumo)." />
  <meta name="theme-color" content="#072C36" />
  <link rel="manifest" href="manifest.webmanifest">
  <style>
    body{margin:0;font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:#fff;color:#111}
    .wrap{max-width:900px;margin:0 auto;padding:28px 18px 60px}
    header{display:flex;align-items:center;gap:12px;margin-bottom:20px}
    .logo{width:42px;height:42px;border-radius:10px;background:#072C36;display:grid;place-items:center}
    .logo span{font-weight:800;color:#fff}
    h1{margin:0;font-size:22px;color:#072C36}
    .sub{color:#555;font-size:13px}
    .card{border:1px solid #ddd;border-radius:14px;padding:16px;margin-bottom:16px;box-shadow:0 2px 5px rgba(0,0,0,.05)}
    label{display:block;font-size:14px;margin:8px 0 6px;color:#072C36}
    input,select,textarea{width:100%;padding:12px;border:1px solid #ccc;border-radius:12px;font-size:16px}
    textarea{resize:vertical;min-height:320px}
    .row{display:grid;grid-template-columns:1fr;gap:12px}
    @media(min-width:640px){.row{grid-template-columns:1fr 1fr}}
    @media(min-width:960px){.row{grid-template-columns:1.2fr 1fr 1fr 1fr 1fr 1fr 1fr}}
    select{min-height:44px}
    .btn{border:none;border-radius:12px;padding:10px 16px;font-weight:700;cursor:pointer;width:100%}
    .btn.primary{background:#25C0BA;color:#fff}
    .actions{display:flex;gap:10px;margin-top:10px;flex-wrap:wrap}
    .actions .btn{width:auto}
    @media(max-width:639px){.actions{flex-direction:column}.actions .btn{width:100%}}
    footer{margin-top:20px;font-size:12px;color:#777;text-align:center}
  </style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="logo"><span>AD</span></div>
    <div>
      <h1>Apostila Direito</h1>
      <div class="sub">Gerador de prompts — Estratégias: Apostila / Simulado / FAQ / Casos / Resumo</div>
    </div>
  </header>

  <form class="card" id="form" onsubmit="return false">
    <h2>Configurações</h2>
    <div class="row">
      <div>
        <label for="estrategia">Estratégia</label>
        <select id="estrategia">
          <option value="Apostila" selected>Apostila</option>
          <option value="Simulado">Simulado</option>
          <option value="FAQ">FAQ</option>
          <option value="Casos">Casos</option>
          <option value="Resumo">Resumo</option>
        </select>
      </div>
      <div>
        <label for="titulo">Tema</label>
        <input id="titulo" placeholder="Ex.: Importunação Sexual — Art. 215-A (CP)" />
      </div>
      <div>
        <label for="materia">Matéria</label>
        <select id="materia">
          <option value="" disabled selected>Selecione</option>
          <optgroup label="Direito Público">
            <option>Direito Constitucional</option>
            <option>Direito Administrativo</option>
            <option>Direito Tributário</option>
            <option>Direito Financeiro</option>
            <option>Direito Eleitoral</option>
            <option>Direito Ambiental</option>
            <option>Direito Internacional</option>
            <option>Direito Militar</option>
          </optgroup>
          <optgroup label="Direito Privado">
            <option>Direito Civil</option>
            <option>Direito Empresarial</option>
            <option>Direito do Consumidor</option>
            <option>Direito Previdenciário</option>
          </optgroup>
          <optgroup label="Direito do Trabalho">
            <option>Direito do Trabalho</option>
            <option>Processo do Trabalho</option>
          </optgroup>
          <optgroup label="Direito Penal">
            <option>Direito Penal</option>
            <option>Processo Penal</option>
            <option>Execução Penal</option>
            <option>Criminologia</option>
          </optgroup>
          <optgroup label="Processual Civil">
            <option>Processo Civil</option>
          </optgroup>
          <optgroup label="Formação e Ética">
            <option>Introdução ao Estudo do Direito</option>
            <option>Teoria Geral do Direito</option>
            <option>Filosofia do Direito</option>
            <option>Sociologia do Direito</option>
            <option>Hermenêutica Jurídica</option>
            <option>Ética Profissional e Estatuto da OAB</option>
            <option>Metodologia da Pesquisa Jurídica</option>
          </optgroup>
        </select>
      </div>
      <div>
        <label for="nivel">Nível</label>
        <select id="nivel">
          <option value="iniciante">Iniciante</option>
          <option value="intermediario" selected>Intermediário</option>
          <option value="avancado">Avançado</option>
        </select>
      </div>
      <div>
        <label for="versao">Versão</label>
        <select id="versao">
          <option value="express">Express</option>
          <option value="completa" selected>Completa</option>
          <option value="avancada">Avançada</option>
        </select>
      </div>
      <div>
        <label for="linguagem">Linguagem</label>
        <select id="linguagem">
          <option value="clara" selected>Clara</option>
          <option value="tecnica">Técnica</option>
          <option value="professor">Professor</option>
        </select>
      </div>
      <div>
        <label for="juris">Jurisprudência</label>
        <select id="juris">
          <option value="off" selected>Sem jurisprudência</option>
          <option value="resumo">Síntese descritiva (sem nº)</option>
          <option value="completa">Completa (com referência)</option>
        </select>
      </div>
      <div style="display:flex;align-items:end">
        <button id="gerar" class="btn primary" type="button">Gerar prompt</button>
      </div>
    </div>
  </form>

  <div class="card">
    <h2>Prompt</h2>
    <textarea id="saida" placeholder="O prompt aparece aqui..."></textarea>
    <div class="actions">
      <button class="btn primary" id="copiar" type="button">Copiar</button>
    </div>
  </div>

  <footer>Apostila Direito • AD</footer>
</div>

<script>
// === Diretrizes por Matéria (aplique só quando pertinentes ao tema) ===
const bySubject = {
  'Direito Constitucional': `Orientação: aplique apenas institutos pertinentes ao título (direitos fundamentais, organização do Estado, controle).`,
  'Direito Administrativo': `Orientação: foque em atos, poderes, licitações/contratos e controle **se** ligados ao tema.`,
  'Direito Tributário': `Orientação: princípios e crédito/lançamento **quando pertinentes** ao tema.`,
  'Direito Financeiro': `Orientação: orçamento público (PPA/LDO/LOA) e responsabilidade fiscal **se** houver nexo.`,
  'Direito Eleitoral': `Orientação: direitos políticos, propaganda e ações eleitorais **conforme** o título.`,
  'Direito Ambiental': `Orientação: princípios, licenciamento, responsabilidade ambiental **se** fizer sentido ao tema.`,
  'Direito Internacional': `Orientação: tratados/fontes, cooperação, conflito de leis **apenas quando aplicável**.`,
  'Direito Militar': `Orientação: CPM/CPPM e competência da Justiça Militar **apenas se pertinente**.`,
  'Direito Civil': `Orientação: ajuste aos subdomínios relevantes (posse, usucapião, contratos, família, sucessões, responsabilidade) — **não inclua** os que não tiverem nexo com o título.`,
  'Direito Empresarial': `Orientação: sociedades, títulos de crédito, recuperação/falência **conforme** o tema.`,
  'Direito do Consumidor': `Orientação: vício/fato, práticas abusivas e garantias **se** o título demandar.`,
  'Direito Previdenciário': `Orientação: benefícios/processo previdenciário **apenas se ligado** ao título.`,
  'Direito do Trabalho': `Orientação: vínculo, jornada, rescisão; teletrabalho/terceirização **se** cabível.`,
  'Processo do Trabalho': `Orientação: rito, prova e recursos **somente** quando necessários ao tema.`,
  'Direito Penal': `Orientação: tipicidade, causas de exclusão e penas **apenas** quando ligados ao título.`,
  'Processo Penal': `Orientação: inquérito, ação penal, cautelares e recursos **quando pertinentes**.`,
  'Execução Penal': `Orientação: progressão/remição e incidentes **conforme** o tema.`,
  'Criminologia': `Orientação: teorias e política criminal **aplicáveis** ao tema.`,
  'Processo Civil': `Orientação: tutelas, saneamento, prova, precedentes/recursos **ligados** ao título.`,
  'Introdução ao Estudo do Direito': `Orientação: fontes, ordenamento e interpretação **apenas** quando úteis ao tema.`,
  'Teoria Geral do Direito': `Orientação: norma/validade/eficácia **se** pertinente.`,
  'Filosofia do Direito': `Orientação: correntes filosóficas **apenas se** houver nexo analítico com o tema.`,
  'Sociologia do Direito': `Orientação: direito e sociedade **quando** cabível.`,
  'Hermenêutica Jurídica': `Orientação: métodos interpretativos/ponderação **se** fizer sentido.`,
  'Ética Profissional e Estatuto da OAB': `Orientação: deontologia e impedimentos **conforme** o foco do título.`,
  'Metodologia da Pesquisa Jurídica': `Orientação: método e ABNT **quando** o objetivo do título assim exigir.`
};

const today = new Date().toISOString().slice(0,10);

// === Afiliados (carregamento JSON externo) ===
let afiliados = null;
async function carregarAfiliados(){
  if (afiliados) return afiliados;
  try{
    const res = await fetch('/data/afiliados.json', { cache: 'no-store' });
    if(!res.ok) throw new Error('Falha ao carregar afiliados.json');
    afiliados = await res.json();
  }catch(e){
    console.warn('[afiliados]', e);
    afiliados = { default: [] };
  }
  return afiliados;
}
function montarBlocoDicas(arr){
  if(!arr || !arr.length) return '';
  const linhas = arr.slice(0,5).map((it,i)=>`${i+1}. [${it.label}](${it.url})`).join('\n');
  return `\n\n### 📚 Dicas de Leitura *(links de afiliado Amazon)*\n${linhas}`;
}

// === Estratégias (inclui RESUMO) ===
const strategies = {
  'Apostila': {
    id:'apostila', showBooks:true,
    block: ({materia, versao, nivel, linguagem}) => `
### Modo: APOSTILA
- Estruture conforme os tópicos didáticos (introdução, perguntas-chave, análise material/processual, debates, casos práticos, resumo executivo).
- Versão: **${versao}** (controla profundidade/volume). Nível: **${nivel}**. Linguagem: **${linguagem}**.`
  },
  'Simulado': {
    id:'simulado', showBooks:false,
    block: ({materia, versao, nivel}) => `
### Modo: SIMULADO
- Gere **10 questões objetivas (A–D)** sobre o tema em **${materia}**.
- Nível: **${nivel}**. Versão: **${versao}** (ajuste a profundidade das justificativas).
- Enunciados claros e sem ambiguidade.
- **Gabarito ao final** no formato: Q1: C — justificativa (1–3 linhas conforme versão).
- Use jurisprudência apenas se selecionada e de forma sintética.`
  },
  'FAQ': {
    id:'faq', showBooks:false,
    block: ({versao, nivel, linguagem}) => `
### Modo: FAQ
- Produza **10 perguntas essenciais** sobre o tema e responda cada uma.
- Adapte a extensão da resposta à **Versão ${versao}** (Express: 1–2 linhas; Completa: 3–5; Avançada: 5–7).
- Nível: **${nivel}**. Linguagem: **${linguagem}**.`
  },
  'Casos': {
    id:'casos', showBooks:true,
    block: ({versao}) => `
### Modo: CASOS
- Explique o tema por **5 casos concretos** diretamente ligados.
- Para cada caso: (1) referência breve; (2) descrição (2–8 linhas conforme **${versao}**); (3) conceito ilustrado e takeaway prático.
- Jurisprudência completa: referência sintética; se off: exemplos doutrinários/noticiosos.`
  },
  'Resumo': {
    id:'resumo', showBooks:false,
    block: ({versao, nivel, linguagem}) => `
### Modo: RESUMO
- Elabore um **resumo estruturado** do tema com foco em definição, elementos essenciais, requisitos, exceções e aplicações práticas.
- **Extensão por Versão**: Express (300–500 palavras); Completa (600–900); Avançada (900–1200, com nuances doutrinárias).
- Inclua **Pontos de atenção/Pegadinhas** (3–5 bullets) e **Exemplos rápidos** (2–3 bullets).
- Linguagem: **${linguagem}**. Nível: **${nivel}**.
- Se jurisprudência for selecionada, traga apenas entendimentos sintéticos diretamente pertinentes.`
  }
};

function jurisRules(mode){
  if(mode==='off') return `- Não inclua jurisprudência específica. Foque em doutrina, artigos e casos práticos.`;
  if(mode==='resumo') return `- Traga apenas tendências jurisprudenciais de forma descritiva, sem nº de processo, citando fontes secundárias estáveis.`;
  if(mode==='completa') return `- Cite acórdãos somente se houver fonte estável (artigos acadêmicos, universidades, escritórios). Formato: Tribunal, Classe+Nº, Relator, Data, Tese (1–2 linhas). Se não encontrar, escreva [NÃO LOCALIZADO].`;
  return '';
}
function nivelAdapt(nivel){
  if(nivel==='iniciante') return `- Adapte a linguagem (iniciante): evite juridiquês, use exemplos simples.`;
  if(nivel==='intermediario') return `- Adapte a linguagem (intermediário): termos técnicos com explicação curta e exemplos práticos.`;
  if(nivel==='avancado') return `- Adapte a linguagem (avançado): precisão técnica, comparações doutrinárias e visão crítica.`;
  return '';
}

function buildPrompt({estrategia,titulo,materia,nivel,versao,linguagem,juris}, dicasStr=''){
  const strat = strategies[estrategia] || strategies['Apostila'];
  return `Você é professor de **${materia}** no Brasil e deve gerar uma **${estrategia.toUpperCase()}** sobre **${titulo}** para um estudante de nível **${nivel}**. Atualize-se até ${today} usando pesquisa na web.

### Objetivo
Entregar material claro, bem estruturado e confiável.

### Etapa de Refinamento (silenciosa, obrigatória)
1. Identifique o TEMA-NÚCLEO do título em 1 linha.
2. Formule 3 a 5 PERGUNTAS OBJETIVAS específicas ao título.
3. Responda-as de forma breve e factual.
4. Defina um PLANO DE SEÇÕES com base nessas respostas.
5. Só então produza a entrega (${estrategia}).
- Se alguma pergunta não puder ser respondida, marque [PENDENTE] e siga de forma conservadora, sem inventar.

### Estratégia de conteúdo
- Linguagem: **${linguagem}**. ${nivelAdapt(nivel)}
- Use fontes confiáveis: cursos, universidades, artigos acadêmicos, blogs de advogados e escritórios.
${jurisRules(juris)}
- Se houver dúvida factual, escreva [VERIFICAR] em vez de presumir.
- **Filtro de pertinência:** não inclua subtemas clássicos da matéria sem nexo direto com o título.

### Diretriz da Matéria (aplicar apenas se pertinente)
${bySubject[materia] || ''}
${strat.block({materia, versao, nivel, linguagem})}

### Saída
Entregue em **Markdown puro**. Seja claro, objetivo e tecnicamente correto.${strat.showBooks ? dicasStr : ''}`;
}

const out = document.getElementById('saida');

document.getElementById('gerar').addEventListener('click', async ()=>{
  const data = {
    estrategia: document.getElementById('estrategia').value,
    titulo: document.getElementById('titulo').value.trim(),
    materia: document.getElementById('materia').value,
    nivel: document.getElementById('nivel').value,
    versao: document.getElementById('versao').value,
    linguagem: document.getElementById('linguagem').value,
    juris: document.getElementById('juris').value
  };
  if(!data.titulo || !data.materia){ alert('Informe Tema e Matéria.'); return; }

  // Afiliados: usa default (ou por matéria, se adicionado depois)
  const db = await carregarAfiliados();
  const lista = (db[data.materia] && db[data.materia].length) ? db[data.materia] : (db.default || []);
  const dicasStr = montarBlocoDicas(lista);

  out.value = buildPrompt(data, dicasStr);
  out.scrollIntoView({behavior:'smooth'});
});

document.getElementById('copiar').addEventListener('click', async ()=>{
  if(!out.value){ alert('Gere o prompt primeiro.'); return; }
  try{ await navigator.clipboard.writeText(out.value); }
  catch(e){ out.select(); document.execCommand('copy'); }
  const btn = document.getElementById('copiar');
  const old = btn.textContent; btn.textContent = 'Copiado!';
  setTimeout(()=> btn.textContent = old, 1200);
});
</script>
</body>
</html>
